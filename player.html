<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Music Player</title>
  <style>
    :root{--ink:#2a2438;--muted:#6b6377}
    body{margin:0;font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink);padding:10px 12px}
    .row{display:flex;gap:8px;align-items:center}
    button{appearance:none;border:1px solid #ddd;border-radius:999px;padding:6px 10px;cursor:pointer}
    .soft{color:var(--muted)}
  </style>
</head>
<body>
  <div class="row">
    <button id="muteBtn" aria-pressed="false">Mute</button>
    <button id="closeBtn">Stop</button>
    <span class="soft" id="status">Playing…</span>
  </div>

  <!-- Added autoplay + playsinline for better mobile behavior -->
  <audio id="bg" src="audio/all-of-me-piano.mp3" preload="auto" loop autoplay playsinline></audio>

  <script>
    const a        = document.getElementById('bg');
    const muteBtn  = document.getElementById('muteBtn');
    const closeBtn = document.getElementById('closeBtn');
    const statusEl = document.getElementById('status');

    // Try to start immediately; opener click counts as a user gesture on mobile
    (async () => {
      try { await a.play(); } catch(e) { /* If blocked, user can tap controls */ }
    })();

    muteBtn.onclick = () => {
      a.muted = !a.muted;
      muteBtn.textContent = a.muted ? 'Unmute' : 'Mute';
      muteBtn.setAttribute('aria-pressed', a.muted ? 'true' : 'false');
      statusEl.textContent = a.paused ? 'Paused' : (a.muted ? 'Playing (muted)…' : 'Playing…');
    };

    closeBtn.onclick = () => { a.pause(); window.close(); };

    // Nice status updates
    a.addEventListener('play',  () => statusEl.textContent = a.muted ? 'Playing (muted)…' : 'Playing…');
    a.addEventListener('pause', () => statusEl.textContent = 'Paused');

    // Safety: pause if the popup is closed by navigation
    window.addEventListener('beforeunload', () => a.pause());
  </script>
</body>
</html>
